# 在线聊天室

## 📖 项目介绍
在线聊天室是一个功能丰富的实时通信应用，基于Node.js和Vue 3开发。它不仅支持多用户同时在线聊天、图片分享、消息引用和表情包等基础功能，还集成了积分系统、红包功能、神秘商店、虚拟宠物、音乐播放等高级特性。本项目采用前后端分离架构，使用Socket.io实现实时通信，同时支持Web端和Electron桌面客户端，提供了简洁友好的用户界面和稳定可靠的服务端支持。

## 🚀 功能特性

### 核心聊天功能
- **实时聊天**：支持多用户同时在线实时通信
- **用户管理**：用户加入/离开通知、在线用户列表显示
- **消息类型**：支持发送文本消息和图片消息
- **消息引用**：支持引用回复其他用户的消息
- **@提及功能**：支持@特定用户
- **用户昵称**：支持自定义和修改用户昵称
- **管理员功能**：支持踢出用户、禁言等管理操作
- **星级回复**：支持AI自动生成明星风格的回复

### 媒体功能
- **图片上传**：支持上传JPG、PNG、GIF和WebP格式的图片
- **动态表情**：内置多种动态表情供用户选择
- **表情包**：支持分类查看和使用表情包

### 积分与经济系统
- **积分系统**：用户可通过在线时长、每日签到等方式获取积分
- **每日签到**：支持每日领取积分奖励
- **红包功能**：支持发送普通红包和随机红包，可设置祝福语
- **红包领取**：实时显示红包领取情况和剩余金额
- **积分历史**：记录用户积分变动历史

### 神秘商店
- **抽奖系统**：用户可使用积分进行抽奖
- **多种奖励**：包括头像框、SVIP特权、登录动画等虚拟物品
- **奖励期限**：部分奖励有时效性，到期自动失效
- **惩罚机制**：包含"黑色炸弹"等惩罚机制增加趣味性

### 虚拟宠物
- **宠物陪伴**：提供可爱的虚拟宠物陪伴用户
- **互动功能**：支持点击宠物进行互动
- **消息提醒**：宠物会显示各种消息和提醒
- **拖拽移动**：支持拖拽宠物到屏幕任意位置

### 音乐功能
- **在线音乐**：集成第三方音乐服务，支持在线播放
- **多音乐源**：支持切换不同的音乐源
- **音乐控制**：提供音乐播放控制界面

### 个性化设置
- **主题切换**：支持多种主题颜色切换
- **音乐源配置**：可自定义音乐源地址
- **客户端ID**：支持配置客户端身份标识
- **管理员模式**：支持激活管理员功能

### 系统管理
- **CDN目录监控**：自动监控图片存储目录大小，超过阈值时自动清理旧文件
- **服务重启清理**：服务重启时自动清理CDN图片目录，释放存储空间
- **聊天历史**：自动保存最近100条聊天记录
- **用户清理**：定期清理长期不活跃的用户账户

## 🛠 技术栈

### 后端
- **Node.js**：JavaScript运行环境
- **Express**：Web应用框架
- **Socket.io**：实时通信库
- **Multer**：文件上传中间件
- **UUID**：生成唯一标识符

### 前端
- **Vue 3**：JavaScript框架
- **Vite**：构建工具
- **Element Plus**：UI组件库
- **Socket.io-client**：Socket.io客户端

### 桌面客户端
- **Electron**：跨平台桌面应用框架

## 📦 安装教程

### 环境要求
- Node.js 14.x 或更高版本
- npm 6.x 或更高版本

### 安装步骤

1. **克隆项目**
```bash
# 克隆项目代码
git clone [项目地址]
cd chat-on-web
```

2. **安装后端依赖**
```bash
# 在项目根目录执行
npm install
```

3. **安装前端依赖**
```bash
# 进入前端目录
cd frontend
npm install
# 返回根目录
cd ..
```

### Docker启动

1. 获取最新镜像

```bash
docker pull ty13363959807/chat-on-web:latest
```

2. 启动
   
```bash
docker run -d --name chat-room --net host \
    -e PORT=3000 \
    -e BIND_ADDRESS=0.0.0.0 \
    -e CDN_SIZE_LIMIT_MB=2048 \
    ty13363959807/chat-on-web:latest
```

3. 支持的env
   
| 名称  | 说明  |
|---|---|
| PORT  |  监听的端口 |
| BIND_ADDRESS  | 监听的地址  |
| CDN_SIZE_LIMIT_MB  | 图片缓存目录的最大值，单位是MB  |

## 🚀 使用说明

### Electron桌面客户端

项目支持Electron桌面客户端，提供更稳定的使用体验和系统集成功能。

#### 配置说明
Electron客户端通过`electron/conf.json`文件进行配置，主要配置项包括服务器地址等。

#### 最小窗口尺寸
客户端已设置最小宽度为800px，最小高度为600px，确保良好的用户体验。

### Web端开发环境

1. **启动后端服务（开发模式）**
```bash
# 在项目根目录执行
npm run dev
# 这将使用nodemon启动服务器，支持热重载
```

2. **启动前端开发服务器**
```bash
# 打开新终端，进入前端目录
cd frontend
npm run dev
```

3. **访问应用**
打开浏览器，访问 `http://localhost:5173`（或前端控制台显示的地址）

### 生产环境

1. **构建前端应用**
```bash
# 在项目根目录执行
npm run build
# 这将自动安装前端依赖并构建前端应用
```

2. **启动后端服务**
```bash
# 在项目根目录执行
npm start
# 或使用PM2等进程管理工具
```

3. **访问应用**
打开浏览器，访问 `http://localhost:3000`（或服务器的IP地址）

### 环境变量配置

- **PORT**：服务器端口，默认3000
- **BIND_ADDRESS**：绑定地址，默认0.0.0.0
- **CDN_SIZE_LIMIT_MB**：CDN图片目录大小限制（MB），默认500MB

## 📁 项目结构

```
chat-on-web/
├── .github/             # GitHub配置目录
│   └── workflows/       # GitHub Actions工作流
├── cdn-images/          # CDN图片存储目录
├── data/                # 数据存储目录
│   ├── emojis/          # 表情包资源
│   ├── images/          # 图片资源
│   ├── notice.md        # 公告内容
│   ├── points.json      # 积分数据
│   ├── redPackets.json  # 红包数据
│   ├── mysteryShop.json # 神秘商店数据
│   └── stars.json       # 星级回复配置
├── electron/            # Electron桌面应用目录
│   ├── application.ico  # 应用图标
│   ├── conf.json        # 客户端配置文件
│   ├── favicon.ico      # 网页图标
│   └── main.js          # Electron主进程文件
├── electron-icon.svg    # Electron图标源文件
├── frontend/            # 前端项目目录
│   ├── index.html       # 入口HTML文件
│   ├── src/             # 前端源码
│   │   ├── App.vue      # 根组件
│   │   ├── Chat.vue    # 聊天室主组件
│   │   ├── components/  # Vue组件
│   │   │   ├── Menu.vue      # 菜单组件
│   │   │   ├── Music.vue     # 音乐组件
│   │   │   ├── Setting.vue   # 设置组件
│   │   │   └── VirtualPet.vue # 虚拟宠物组件
│   │   ├── views/       # 页面视图
│   │   │   ├── Profile.vue   # 个人资料页
│   │   │   └── Frame.vue     # 网站导航页
│   │   ├── main.js      # 入口文件
│   │   ├── styles/      # 样式文件
│   │   └── utils/       # 工具函数
│   └── vite.config.js   # Vite配置文件
├── src/                 # 后端源码
│   ├── app.js           # Express应用配置
│   ├── config/          # 配置文件
│   │   ├── aiConfig.json # AI配置文件
│   │   └── constants.js  # 常量定义
│   ├── middleware/      # 中间件
│   │   └── auth.js      # 认证中间件
│   ├── routes/          # 路由定义
│   │   ├── api.js       # API路由
│   │   └── index.js     # 主页路由
│   ├── services/        # 业务逻辑
│   │   ├── pointsService.js    # 积分服务
│   │   ├── redPacketService.js # 红包服务
│   │   ├── starReplyService.js # 星级回复服务
│   │   ├── mysteryShopService.js # 神秘商店服务
│   │   ├── storageService.js   # 存储服务
│   │   └── userService.js      # 用户服务
│   └── websocket/       # WebSocket处理
│       └── socketHandler.js    # Socket事件处理
├── server.js            # 后端入口文件
├── README.md            # 项目说明文档（中文）
└── README.en.md         # 项目说明文档（英文）
```

## 🔧 功能详解

### 用户系统
- **用户加入**：输入用户名即可加入聊天室
- **用户列表**：实时显示当前在线用户
- **昵称修改**：支持修改用户昵称，所有历史消息也会同步更新
- **用户身份**：每个用户有唯一的userId和coreId，coreId用于积分系统
- **用户状态**：显示用户在线状态、积分、特权等信息

### 聊天功能
- **发送消息**：输入文本后按Enter发送消息
- **引用回复**：右键点击消息可选择引用回复
- **@提及**：使用@符号提及特定用户，该用户会收到通知
- **图片分享**：支持上传和分享图片
- **表情包**：支持发送各种表情包
- **消息历史**：自动保存最近100条聊天记录

### 积分系统
- **获取积分**：
  - 每小时在线获得10积分
  - 每日签到可获得100积分
  - 领取红包可能获得积分
- **使用积分**：
  - 发送红包需要消耗积分
  - 神秘商店抽奖需要100积分
- **积分记录**：系统会记录用户积分变动历史

### 红包功能
- **红包类型**：
  - 普通红包：每个领取者获得相同金额
  - 随机红包：每个领取者获得随机金额
- **红包设置**：
  - 设置总积分和红包个数
  - 添加祝福语
- **红包状态**：
  - 活跃：可领取状态
  - 已过期：超过24小时未领取完
  - 已领完：所有红包已被领取

### 神秘商店
- **抽奖机制**：每次抽奖消耗100积分
- **奖励类型**：
  - 精美头像框（3天使用权）
  - SVIP特权（3天使用权）
  - 登录出场炫酷动画（3天使用权）
  - 积分奖励（200/500/1000积分）
  - 黑色炸弹（损失200积分）
- **奖励概率**：不同奖励有不同的获取概率

### 虚拟宠物
- **宠物选择**：支持选择不同的宠物形象
- **宠物互动**：点击宠物可触发互动
- **消息显示**：宠物会显示各种消息和提醒
- **位置调整**：支持拖拽宠物到屏幕任意位置

### 音乐功能
- **音乐源**：支持多个在线音乐源
- **音乐播放**：提供音乐播放界面
- **源切换**：支持在设置中切换音乐源

### 个性化设置
- **主题切换**：支持多种主题颜色
- **音乐源配置**：可自定义音乐源地址
- **客户端ID**：支持配置客户端身份标识
- **管理员模式**：连续点击版本号10次可激活

## 🎮 高级功能

### AI集成
- **星级回复**：支持AI自动生成明星风格的回复
- **AI配置**：可通过配置文件设置AI接口参数
- **本地回退**：当AI不可用时，使用本地生成的回复

### 管理员功能
- **踢出用户**：支持将用户踢出聊天室
- **禁言设置**：可设置禁言时长
- **用户管理**：查看和管理在线用户

### 数据管理
- **自动清理**：定期清理过期数据和长期不活跃用户
- **数据备份**：重要数据持久化存储
- **存储监控**：监控CDN目录大小，自动清理

## 🌟 特色亮点

1. **丰富的交互功能**：不仅支持基础聊天，还包含积分、红包、抽奖等游戏化元素
2. **个性化体验**：支持主题切换、虚拟宠物、个性化头像框等
3. **多端支持**：同时支持Web和Electron桌面客户端
4. **AI集成**：支持AI自动生成回复，增强聊天体验
5. **完善的系统**：包含用户管理、数据清理、存储监控等完整功能

## 📝 更新日志

### v1.0.0
- 初始版本发布
- 实现基础聊天功能
- 添加图片分享和表情包
- 集成积分系统和红包功能
- 实现神秘商店和虚拟宠物
- 添加音乐播放功能
- 支持Electron桌面客户端

## 🤝 贡献指南

欢迎提交Issue和Pull Request来改进项目。

## 📄 许可证

本项目采用 ISC 许可证。
